CREATE DATABASE db_ingressos;

USE db_ingressos;

CREATE TABLE TBL_FILME (
    ID_FILME BIGINT PRIMARY KEY IDENTITY,
    TX_NOME VARCHAR(50) NOT NULL,
    NR_DURACAO INT NOT NULL,
    TP_GENERO VARCHAR(17) NOT NULL,
    TP_CLASSIFICACAO VARCHAR(5),
    NR_ANO INT,
    TX_CAPA VARCHAR(300),
    TX_DIRETOR VARCHAR(300),
    TX_ELENCO VARCHAR(300),
    TX_DESCRICAO VARCHAR(500),
    NR_AVALIACAO FLOAT
);

CREATE TABLE TBL_SALA (
    ID_SALA BIGINT PRIMARY KEY IDENTITY,
    TX_NOME VARCHAR(50) NOT NULL,
    NR_PRECO FLOAT NOT NULL
);

CREATE TABLE TBL_ASSENTO (
    ID_ASSENTO BIGINT PRIMARY KEY IDENTITY,
    TX_FILEIRA VARCHAR(1) NOT NULL,
    NR_POSICAO INT NOT NULL,
    ID_SALA BIGINT NOT NULL,
    FOREIGN KEY (ID_SALA) REFERENCES TBL_SALA(ID_SALA)
);

CREATE TABLE TBL_SESSAO (
    ID_SESSAO BIGINT PRIMARY KEY IDENTITY,
    DT_DATA DATE NOT NULL,
    HR_HORARIO TIME NOT NULL,
    NR_PRECO FLOAT NOT NULL,
    ID_SALA BIGINT NOT NULL,
    ID_FILME BIGINT NOT NULL,
    FOREIGN KEY (ID_SALA) REFERENCES TBL_SALA(ID_SALA),
    FOREIGN KEY (ID_FILME) REFERENCES TBL_FILME(ID_FILME)
);

CREATE TABLE TBL_PEDIDO (
    ID_PEDIDO BIGINT PRIMARY KEY IDENTITY,
    DT_CRIACAO DATETIME2 NOT NULL,
    TP_STATUS VARCHAR(9) NOT NULL
);

CREATE TABLE TBL_INGRESSO (
    ID_INGRESSO BIGINT PRIMARY KEY IDENTITY,
    TP_INGRESSO VARCHAR(9) NOT NULL,
    NR_PRECO FLOAT NOT NULL,
    ID_SESSAO BIGINT NOT NULL,
    ID_ASSENTO BIGINT NOT NULL,
    FOREIGN KEY (ID_SESSAO) REFERENCES TBL_SESSAO(ID_SESSAO),
    FOREIGN KEY (ID_ASSENTO) REFERENCES TBL_ASSENTO(ID_ASSENTO)
);

CREATE TABLE TBL_REL_PEDIDO_INGRESSO (
    ID_INGRESSO BIGINT NOT NULL,
    ID_PEDIDO BIGINT NOT NULL,
    FOREIGN KEY (ID_INGRESSO) REFERENCES TBL_INGRESSO(ID_INGRESSO),
    FOREIGN KEY (ID_PEDIDO) REFERENCES TBL_PEDIDO(ID_PEDIDO)
);

CREATE TABLE TBL_FORMA_PAGAMENTO (
    ID_FORMA_PAGAMENTO BIGINT PRIMARY KEY IDENTITY,
    TX_NOME VARCHAR(30) NOT NULL,
    TP_TIPO VARCHAR(14) NOT NULL
);

CREATE TABLE TBL_PAGAMENTO (
    ID_PAGAMENTO BIGINT PRIMARY KEY IDENTITY,
    NR_VALOR FLOAT NOT NULL,
    TP_STATUS VARCHAR(10) NOT NULL,
    ID_PEDIDO BIGINT NOT NULL,
    ID_FORMA_PAGAMENTO BIGINT NOT NULL,
    FOREIGN KEY (ID_PEDIDO) REFERENCES TBL_PEDIDO(ID_PEDIDO),
    FOREIGN KEY (ID_FORMA_PAGAMENTO) REFERENCES TBL_FORMA_PAGAMENTO(ID_FORMA_PAGAMENTO)
);

CREATE TABLE TBL_DADOS_PAGAMENTO (
    ID_DADOS_PAGAMENTO BIGINT PRIMARY KEY IDENTITY,
    ID_PAGAMENTO BIGINT NOT NULL,
    FOREIGN KEY (ID_PAGAMENTO) REFERENCES TBL_PAGAMENTO(ID_PAGAMENTO)
);

CREATE TABLE TBL_DADOS_CARTAO (
    ID_DADOS_PAGAMENTO BIGINT PRIMARY KEY,
    TX_NOME VARCHAR(255),
    TX_NUMERO VARCHAR(19),
    TX_EXPIRACAO VARCHAR(5),
    TX_CODIGO VARCHAR(3),
    FOREIGN KEY (ID_DADOS_PAGAMENTO) REFERENCES TBL_DADOS_PAGAMENTO(ID_DADOS_PAGAMENTO)
);

CREATE TABLE TBL_DADOS_PIX (
    ID_DADOS_PAGAMENTO BIGINT PRIMARY KEY,
    TX_CHAVE VARCHAR(255),
    FOREIGN KEY (ID_DADOS_PAGAMENTO) REFERENCES TBL_DADOS_PAGAMENTO(ID_DADOS_PAGAMENTO)
);

CREATE TABLE TBL_DADOS_BOLETO (
    ID_DADOS_PAGAMENTO BIGINT PRIMARY KEY,
    TX_LINHA_DIGITAVEL VARCHAR(255),
    TX_CODIGO_BARRAS VARCHAR(255),
    DT_VENCIMENTO DATE,
    FOREIGN KEY (ID_DADOS_PAGAMENTO) REFERENCES TBL_DADOS_PAGAMENTO(ID_DADOS_PAGAMENTO)
);
